<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TIFFDirectory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">org.apache.xmlgraphics:xmlgraphics-commons</a> &gt; <a href="index.source.html" class="el_package">org.apache.xmlgraphics.image.codec.tiff</a> &gt; <span class="el_source">TIFFDirectory.java</span></div><h1>TIFFDirectory.java</h1><pre class="source lang-java linenums">/* $$ This file has been instrumented by Clover 4.5.2#20240131180750 $$ *//*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/* $Id: TIFFDirectory.java 1732018 2016-02-24 04:51:06Z gadams $ */

package org.apache.xmlgraphics.image.codec.tiff;

import java.io.IOException;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import org.apache.xmlgraphics.image.codec.util.PropertyUtil;
import org.apache.xmlgraphics.image.codec.util.SeekableStream;

// CSOFF: ConstantName
// CSOFF: EmptyStatement
// CSOFF: InnerAssignment
// CSOFF: LocalVariableName
// CSOFF: MemberName
// CSOFF: MultipleVariableDeclarations
// CSOFF: NeedBraces
// CSOFF: ParameterName
// CSOFF: WhitespaceAround

/**
 * A class representing an Image File Directory (IFD) from a TIFF 6.0
 * stream.  The TIFF file format is described in more detail in the
 * comments for the TIFFDescriptor class.
 *
 * &lt;p&gt; A TIFF IFD consists of a set of TIFFField tags.  Methods are
 * provided to query the set of tags and to obtain the raw field
 * array.  In addition, convenience methods are provided for acquiring
 * the values of tags that contain a single value that fits into a
 * byte, int, long, float, or double.
 *
 * &lt;p&gt; Every TIFF file is made up of one or more public IFDs that are
 * joined in a linked list, rooted in the file header.  A file may
 * also contain so-called private IFDs that are referenced from
 * tag data and do not appear in the main list.
 *
 * &lt;p&gt;&lt;b&gt; This class is not a committed part of the JAI API.  It may
 * be removed or changed in future releases of JAI.&lt;/b&gt;
 *
 * @see TIFFField
 * @version $Id: TIFFDirectory.java 1732018 2016-02-24 04:51:06Z gadams $
 */
<span class="pc bpc" id="L65" title="3 of 4 branches missed.">@java.lang.SuppressWarnings({&quot;fallthrough&quot;}) public class TIFFDirectory implements Serializable {public static class __CLR4_5_23zg3zgm6lb4yko{public static com_atlassian_clover.CoverageRecorder R;public static com_atlassian_clover.CloverProfile[] profiles = { };@java.lang.SuppressWarnings(&quot;unchecked&quot;) public static &lt;I, T extends I&gt; I lambdaInc(final int i,final T l,final int si){java.lang.reflect.InvocationHandler h=new java.lang.reflect.InvocationHandler(){public java.lang.Object invoke(java.lang.Object p,java.lang.reflect.Method m,java.lang.Object[] a) throws Throwable{R.inc(i);R.inc(si);try{return m.invoke(l,a);}catch(java.lang.reflect.InvocationTargetException e){throw e.getCause()!=null?e.getCause():new RuntimeException(&quot;Clover failed to invoke instrumented lambda&quot;,e);}}};return (I)java.lang.reflect.Proxy.newProxyInstance(l.getClass().getClassLoader(),l.getClass().getInterfaces(),h);}public static &lt;T&gt; T caseInc(int i,java.util.function.Supplier&lt;T&gt; s){R.inc(i);return s.get();}public static void caseInc(int i,Runnable r){R.inc(i);r.run();}static{com_atlassian_clover.CoverageRecorder _R=null;try{com_atlassian_clover.CloverVersionInfo.An_old_version_of_clover_is_on_your_compilation_classpath___Please_remove___Required_version_is___4_5_2();if(20240131180750L!=com_atlassian_clover.CloverVersionInfo.getBuildStamp()){com_atlassian_clover.Clover.l(&quot;[CLOVER] WARNING: The Clover version used in instrumentation shall match the runtime version.&quot;);com_atlassian_clover.Clover.l(&quot;[CLOVER] WARNING: Instr=4.5.2#20240131180750,Runtime=&quot;+com_atlassian_clover.CloverVersionInfo.getReleaseNum()+&quot;#&quot;+com_atlassian_clover.CloverVersionInfo.getBuildStamp());}R=com_atlassian_clover.Clover.getNullRecorder();_R=com_atlassian_clover.Clover.getNullRecorder();_R=com_atlassian_clover.Clover.getRecorder(&quot;\u002f\u0063\u006f\u0064\u0065\u002f\u0063\u006f\u006e\u0063\u006f\u0072\u0064\u0069\u0061\u002f\u0053\u004f\u0045\u004e\u002d\u0033\u0034\u0035\u002d\u0054\u0075\u0074\u006f\u0072\u0069\u0061\u006c\u0073\u002f\u0074\u0075\u0074\u006f\u0072\u0069\u0061\u006c\u0031\u002f\u0050\u0061\u0072\u0074\u002d\u0042\u002f\u0078\u006d\u006c\u0067\u0072\u0061\u0070\u0068\u0069\u0063\u0073\u002d\u0063\u006f\u006d\u006d\u006f\u006e\u0073\u002d\u0032\u002e\u0038\u002f\u0074\u0061\u0072\u0067\u0065\u0074\u002f\u0063\u006c\u006f\u0076\u0065\u0072\u002f\u0063\u006c\u006f\u0076\u0065\u0072\u002e\u0064\u0062&quot;,1738360798893L,8589935092L,5469,profiles,new java.lang.String[]{&quot;clover.distributed.coverage&quot;,null});}catch(java.lang.SecurityException e){java.lang.System.err.println(&quot;[CLOVER] FATAL ERROR: Clover could not be initialised because it has insufficient security privileges. Please consult the Clover documentation on the security policy file changes required. (&quot;+e.getClass()+&quot;:&quot;+e.getMessage()+&quot;)&quot;);}catch(java.lang.NoClassDefFoundError e){java.lang.System.err.println(&quot;[CLOVER] FATAL ERROR: Clover could not be initialised. Are you sure you have Clover in the runtime classpath? (&quot;+e.getClass()+&quot;:&quot;+e.getMessage()+&quot;)&quot;);}catch(java.lang.Throwable t){java.lang.System.err.println(&quot;[CLOVER] FATAL ERROR: Clover could not be initialised because of an unexpected error. (&quot;+t.getClass()+&quot;:&quot;+t.getMessage()+&quot;)&quot;);}R=_R;}}public static final com_atlassian_clover.TestNameSniffer __CLR4_5_2_TEST_NAME_SNIFFER=com_atlassian_clover.TestNameSniffer.NULL_INSTANCE;</span>

    private static final long serialVersionUID = 2007844835460959003L;
    /** A boolean storing the endianness of the stream. */
    boolean isBigEndian;

    /** The number of entries in the IFD. */
    int numEntries;

    /** An array of TIFFFields. */
    TIFFField[] fields;

    /** A Hashtable indexing the fields by tag number. */
<span class="pc" id="L78">    Map fieldIndex = new HashMap();</span>

    /** The offset of this IFD. */
<span class="pc" id="L81">    long ifdOffset = 8;</span>

    /** The offset of the next IFD. */
    long nextIFDOffset;

    /** The default constructor. */
<span class="nc" id="L87">    TIFFDirectory() {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5164); }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

<span class="fc" id="L89">    private static boolean isValidEndianTag(int endian) {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5165);</span>
<span class="pc bpc" id="L90" title="1 of 4 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5166);return ((endian == 0x4949) || (endian == 0x4d4d));</span>
<span class="fc" id="L91">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Constructs a TIFFDirectory from a SeekableStream.
     * The directory parameter specifies which directory to read from
     * the linked list present in the stream; directory 0 is normally
     * read but it is possible to store multiple images in a single
     * TIFF file by maintaing multiple directories.
     *
     * @param stream a SeekableStream to read from.
     * @param directory the index of the directory to read.
     */
    public TIFFDirectory(SeekableStream stream, int directory)
<span class="fc" id="L104">        throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5167);</span>

<span class="fc" id="L106">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5168);long globalSaveOffset = stream.getFilePointer();</span>
<span class="fc" id="L107">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5169);long ifdOffset;</span>

        // Read the TIFF header
<span class="fc" id="L110">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5170);stream.seek(0L);</span>
<span class="fc" id="L111">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5171);int endian = stream.readUnsignedShort();</span>
<span class="pc bpc" id="L112" title="7 of 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5172);if ((((!isValidEndianTag(endian))&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5173)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5174)==0&amp;false))) {{</span>
<span class="nc" id="L113">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5175);throw new IllegalArgumentException(PropertyUtil.getString(&quot;TIFFDirectory1&quot;));</span>
        }
<span class="fc bfc" id="L115" title="All 2 branches covered.">        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5176);isBigEndian = (endian == 0x4d4d);</span>

<span class="fc" id="L117">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5177);int magic = readUnsignedShort(stream);</span>
<span class="pc bpc" id="L118" title="7 of 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5178);if ((((magic != 42)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5179)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5180)==0&amp;false))) {{</span>
<span class="nc" id="L119">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5181);throw new IllegalArgumentException(PropertyUtil.getString(&quot;TIFFDirectory2&quot;));</span>
        }

        // Get the initial ifd offset as an unsigned int (using a long)
<span class="fc" id="L123">        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5182);ifdOffset = readUnsignedInt(stream);</span>

<span class="pc bpc" id="L125" title="4 of 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5183);for (int i = 0; (((i &lt; directory)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5184)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5185)==0&amp;false)); i++) {{</span>
<span class="pc bpc" id="L126" title="7 of 10 branches missed.">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5186);if ((((ifdOffset == 0L)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5187)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5188)==0&amp;false))) {{</span>
<span class="nc" id="L127">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5189);throw new IllegalArgumentException(PropertyUtil.getString(&quot;TIFFDirectory3&quot;));</span>
            }

<span class="fc" id="L130">            }__CLR4_5_23zg3zgm6lb4yko.R.inc(5190);stream.seek(ifdOffset);</span>
<span class="fc" id="L131">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5191);long entries = readUnsignedShort(stream);</span>
<span class="fc" id="L132">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5192);stream.skip(12 * entries);</span>

<span class="fc" id="L134">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5193);ifdOffset = readUnsignedInt(stream);</span>
        }
<span class="pc bpc" id="L136" title="4 of 10 branches missed.">        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5194);if ((((ifdOffset == 0L)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5195)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5196)==0&amp;false))) {{</span>
<span class="fc" id="L137">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5197);throw new IllegalArgumentException(PropertyUtil.getString(&quot;TIFFDirectory3&quot;));</span>
        }

<span class="fc" id="L140">        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5198);stream.seek(ifdOffset);</span>
<span class="fc" id="L141">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5199);initialize(stream);</span>
<span class="fc" id="L142">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5200);stream.seek(globalSaveOffset);</span>
<span class="fc" id="L143">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Constructs a TIFFDirectory by reading a SeekableStream.
     * The ifd_offset parameter specifies the stream offset from which
     * to begin reading; this mechanism is sometimes used to store
     * private IFDs within a TIFF file that are not part of the normal
     * sequence of IFDs.
     *
     * @param stream a SeekableStream to read from.
     * @param ifdOffset the long byte offset of the directory.
     * @param directory the index of the directory to read beyond the
     *        one at the current stream offset; zero indicates the IFD
     *        at the current offset.
     */
    public TIFFDirectory(SeekableStream stream, long ifdOffset, int directory)
<span class="nc" id="L159">        throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5201);</span>

<span class="nc" id="L161">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5202);long globalSaveOffset = stream.getFilePointer();</span>
<span class="nc" id="L162">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5203);stream.seek(0L);</span>
<span class="nc" id="L163">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5204);int endian = stream.readUnsignedShort();</span>
<span class="nc bnc" id="L164" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5205);if ((((!isValidEndianTag(endian))&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5206)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5207)==0&amp;false))) {{</span>
<span class="nc" id="L165">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5208);throw new IllegalArgumentException(PropertyUtil.getString(&quot;TIFFDirectory1&quot;));</span>
        }
<span class="nc bnc" id="L167" title="All 2 branches missed.">        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5209);isBigEndian = (endian == 0x4d4d);</span>

        // Seek to the first IFD.
<span class="nc" id="L170">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5210);stream.seek(ifdOffset);</span>

        // Seek to desired IFD if necessary.
<span class="nc" id="L173">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5211);int dirNum = 0;</span>
<span class="nc bnc" id="L174" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5212);while ((((dirNum &lt; directory)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5213)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5214)==0&amp;false))) {{</span>
            // Get the number of fields in the current IFD.
<span class="nc" id="L176">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5215);long numEntries = readUnsignedShort(stream);</span>

            // Skip to the next IFD offset value field.
<span class="nc" id="L179">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5216);stream.seek(ifdOffset + 12 * numEntries);</span>

            // Read the offset to the next IFD beyond this one.
<span class="nc" id="L182">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5217);ifdOffset = readUnsignedInt(stream);</span>

            // Seek to the next IFD.
<span class="nc" id="L185">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5218);stream.seek(ifdOffset);</span>

            // Increment the directory.
<span class="nc" id="L188">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5219);dirNum++;</span>
<span class="nc" id="L189">        }</span>

<span class="nc" id="L191">        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5220);initialize(stream);</span>
<span class="nc" id="L192">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5221);stream.seek(globalSaveOffset);</span>
<span class="nc" id="L193">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

<span class="fc" id="L195">    private static final int[] SIZE_OF_TYPE = {</span>
        0, //  0 = n/a
        1, //  1 = byte
        1, //  2 = ascii
        2, //  3 = short
        4, //  4 = long
        8, //  5 = rational
        1, //  6 = sbyte
        1, //  7 = undefined
        2, //  8 = sshort
        4, //  9 = slong
        8, // 10 = srational
        4, // 11 = float
        8  // 12 = double
    };

<span class="fc" id="L211">    private void initialize(SeekableStream stream) throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5222);</span>
<span class="fc" id="L212">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5223);long nextTagOffset;</span>
<span class="fc" id="L213">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5224);int i;</span>
<span class="fc" id="L214">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5225);int j;</span>

<span class="fc" id="L216">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5226);ifdOffset = stream.getFilePointer();</span>

<span class="fc" id="L218">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5227);numEntries = readUnsignedShort(stream);</span>
<span class="fc" id="L219">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5228);fields = new TIFFField[numEntries];</span>

<span class="pc bpc" id="L221" title="4 of 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5229);for (i = 0; (((i &lt; numEntries)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5230)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5231)==0&amp;false)); i++) {{</span>
<span class="fc" id="L222">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5232);int tag = readUnsignedShort(stream);</span>
<span class="fc" id="L223">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5233);int type = readUnsignedShort(stream);</span>
<span class="fc" id="L224">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5234);int count = (int)(readUnsignedInt(stream));</span>
<span class="fc" id="L225">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5235);int value = 0;</span>

            // The place to return to to read the next tag
<span class="fc" id="L228">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5236);nextTagOffset = stream.getFilePointer() + 4;</span>

<span class="fc" id="L230">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5237);try {</span>
                // If the tag data can't fit in 4 bytes, the next 4 bytes
                // contain the starting offset of the data
<span class="pc bpc" id="L233" title="4 of 10 branches missed.">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5238);if ((((count * SIZE_OF_TYPE[type] &gt; 4)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5239)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5240)==0&amp;false))) {{</span>
<span class="fc" id="L234">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5241);value = (int)(readUnsignedInt(stream));</span>
<span class="fc" id="L235">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5242);stream.seek(value);</span>
                }
<span class="nc" id="L237">            }} catch (ArrayIndexOutOfBoundsException ae) {</span>
                // System.err.println(tag + &quot; &quot; + &quot;TIFFDirectory4&quot;); TODO - log this message
                // if the data type is unknown we should skip this TIFF Field
<span class="nc" id="L240">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5243);stream.seek(nextTagOffset);</span>
<span class="nc" id="L241">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5244);continue;</span>
<span class="fc" id="L242">            }</span>

<span class="fc" id="L244">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5245);fieldIndex.put(tag, i);</span>
<span class="fc" id="L245">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5246);Object obj = null;</span>

<span class="pc bpc" id="L247" title="8 of 13 branches missed.">            boolean __CLB4_5_2_bool0=false;__CLR4_5_23zg3zgm6lb4yko.R.inc(5247);switch (type) {</span>
<span class="pc bpc" id="L248" title="1 of 2 branches missed.">            case TIFFField.TIFF_BYTE:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5248);__CLB4_5_2_bool0=true;}</span>
<span class="pc bpc" id="L249" title="1 of 2 branches missed.">            case TIFFField.TIFF_SBYTE:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5249);__CLB4_5_2_bool0=true;}</span>
<span class="pc bpc" id="L250" title="1 of 2 branches missed.">            case TIFFField.TIFF_UNDEFINED:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5250);__CLB4_5_2_bool0=true;}</span>
<span class="fc bfc" id="L251" title="All 2 branches covered.">            case TIFFField.TIFF_ASCII:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5251);__CLB4_5_2_bool0=true;}</span>
<span class="fc" id="L252">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5252);byte[] bvalues = new byte[count];</span>
<span class="fc" id="L253">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5253);stream.readFully(bvalues, 0, count);</span>

<span class="pc bpc" id="L255" title="4 of 10 branches missed.">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5254);if ((((type == TIFFField.TIFF_ASCII)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5255)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5256)==0&amp;false))) {{</span>

                    // Can be multiple strings
<span class="fc" id="L258">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5257);int index = 0;</span>
<span class="fc" id="L259">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5258);int prevIndex = 0;</span>
<span class="fc" id="L260">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5259);List v = new ArrayList();</span>

<span class="pc bpc" id="L262" title="4 of 10 branches missed.">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5260);while ((((index &lt; count)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5261)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5262)==0&amp;false))) {{</span>

<span class="pc bpc" id="L264" title="5 of 12 branches missed.">                        __CLR4_5_23zg3zgm6lb4yko.R.inc(5263);while (((((index &lt; count) &amp;&amp; (bvalues[index++] != 0))&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5264)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5265)==0&amp;false))) {{</span>
                            // NOP
                        }

                        // When we encountered zero, means one string has ended
<span class="fc" id="L269">                        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5266);v.add(new String(bvalues, prevIndex,</span>
                                         (index - prevIndex), &quot;UTF-8&quot;));
<span class="fc" id="L271">                        __CLR4_5_23zg3zgm6lb4yko.R.inc(5267);prevIndex = index;</span>
                    }

<span class="fc" id="L274">                    }__CLR4_5_23zg3zgm6lb4yko.R.inc(5268);count = v.size();</span>
<span class="fc" id="L275">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5269);String[] strings = new String[count];</span>
<span class="fc" id="L276">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5270);v.toArray(strings);</span>
<span class="fc" id="L277">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5271);obj = strings;</span>
<span class="fc" id="L278">                } }else {{</span>
<span class="fc" id="L279">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5272);obj = bvalues;</span>
                }

<span class="fc" id="L282">                }__CLR4_5_23zg3zgm6lb4yko.R.inc(5273);break;</span>

<span class="pc bpc" id="L284" title="1 of 2 branches missed.">            case TIFFField.TIFF_SHORT:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5274);__CLB4_5_2_bool0=true;}</span>
<span class="fc" id="L285">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5275);char[] cvalues = new char[count];</span>
<span class="pc bpc" id="L286" title="4 of 10 branches missed.">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5276);for (j = 0; (((j &lt; count)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5277)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5278)==0&amp;false)); j++) {{</span>
<span class="fc" id="L287">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5279);cvalues[j] = (char)(readUnsignedShort(stream));</span>
                }
<span class="fc" id="L289">                }__CLR4_5_23zg3zgm6lb4yko.R.inc(5280);obj = cvalues;</span>
<span class="fc" id="L290">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5281);break;</span>

<span class="pc bpc" id="L292" title="1 of 2 branches missed.">            case TIFFField.TIFF_LONG:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5282);__CLB4_5_2_bool0=true;}</span>
<span class="fc" id="L293">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5283);long[] lvalues = new long[count];</span>
<span class="pc bpc" id="L294" title="4 of 10 branches missed.">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5284);for (j = 0; (((j &lt; count)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5285)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5286)==0&amp;false)); j++) {{</span>
<span class="fc" id="L295">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5287);lvalues[j] = readUnsignedInt(stream);</span>
                }
<span class="fc" id="L297">                }__CLR4_5_23zg3zgm6lb4yko.R.inc(5288);obj = lvalues;</span>
<span class="fc" id="L298">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5289);break;</span>

<span class="pc bpc" id="L300" title="1 of 2 branches missed.">            case TIFFField.TIFF_RATIONAL:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5290);__CLB4_5_2_bool0=true;}</span>
<span class="fc" id="L301">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5291);long[][] llvalues = new long[count][2];</span>
<span class="pc bpc" id="L302" title="4 of 10 branches missed.">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5292);for (j = 0; (((j &lt; count)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5293)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5294)==0&amp;false)); j++) {{</span>
<span class="fc" id="L303">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5295);llvalues[j][0] = readUnsignedInt(stream);</span>
<span class="fc" id="L304">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5296);llvalues[j][1] = readUnsignedInt(stream);</span>
                }
<span class="fc" id="L306">                }__CLR4_5_23zg3zgm6lb4yko.R.inc(5297);obj = llvalues;</span>
<span class="fc" id="L307">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5298);break;</span>

<span class="nc bnc" id="L309" title="All 2 branches missed.">            case TIFFField.TIFF_SSHORT:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5299);__CLB4_5_2_bool0=true;}</span>
<span class="nc" id="L310">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5300);short[] svalues = new short[count];</span>
<span class="nc bnc" id="L311" title="All 10 branches missed.">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5301);for (j = 0; (((j &lt; count)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5302)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5303)==0&amp;false)); j++) {{</span>
<span class="nc" id="L312">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5304);svalues[j] = readShort(stream);</span>
                }
<span class="nc" id="L314">                }__CLR4_5_23zg3zgm6lb4yko.R.inc(5305);obj = svalues;</span>
<span class="nc" id="L315">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5306);break;</span>

<span class="nc bnc" id="L317" title="All 2 branches missed.">            case TIFFField.TIFF_SLONG:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5307);__CLB4_5_2_bool0=true;}</span>
<span class="nc" id="L318">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5308);int[] ivalues = new int[count];</span>
<span class="nc bnc" id="L319" title="All 10 branches missed.">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5309);for (j = 0; (((j &lt; count)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5310)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5311)==0&amp;false)); j++) {{</span>
<span class="nc" id="L320">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5312);ivalues[j] = readInt(stream);</span>
                }
<span class="nc" id="L322">                }__CLR4_5_23zg3zgm6lb4yko.R.inc(5313);obj = ivalues;</span>
<span class="nc" id="L323">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5314);break;</span>

<span class="nc bnc" id="L325" title="All 2 branches missed.">            case TIFFField.TIFF_SRATIONAL:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5315);__CLB4_5_2_bool0=true;}</span>
<span class="nc" id="L326">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5316);int[][] iivalues = new int[count][2];</span>
<span class="nc bnc" id="L327" title="All 10 branches missed.">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5317);for (j = 0; (((j &lt; count)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5318)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5319)==0&amp;false)); j++) {{</span>
<span class="nc" id="L328">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5320);iivalues[j][0] = readInt(stream);</span>
<span class="nc" id="L329">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5321);iivalues[j][1] = readInt(stream);</span>
                }
<span class="nc" id="L331">                }__CLR4_5_23zg3zgm6lb4yko.R.inc(5322);obj = iivalues;</span>
<span class="nc" id="L332">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5323);break;</span>

<span class="nc bnc" id="L334" title="All 2 branches missed.">            case TIFFField.TIFF_FLOAT:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5324);__CLB4_5_2_bool0=true;}</span>
<span class="nc" id="L335">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5325);float[] fvalues = new float[count];</span>
<span class="nc bnc" id="L336" title="All 10 branches missed.">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5326);for (j = 0; (((j &lt; count)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5327)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5328)==0&amp;false)); j++) {{</span>
<span class="nc" id="L337">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5329);fvalues[j] = readFloat(stream);</span>
                }
<span class="nc" id="L339">                }__CLR4_5_23zg3zgm6lb4yko.R.inc(5330);obj = fvalues;</span>
<span class="nc" id="L340">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5331);break;</span>

<span class="nc bnc" id="L342" title="All 2 branches missed.">            case TIFFField.TIFF_DOUBLE:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5332);__CLB4_5_2_bool0=true;}</span>
<span class="nc" id="L343">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5333);double[] dvalues = new double[count];</span>
<span class="nc bnc" id="L344" title="All 10 branches missed.">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5334);for (j = 0; (((j &lt; count)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5335)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5336)==0&amp;false)); j++) {{</span>
<span class="nc" id="L345">                    __CLR4_5_23zg3zgm6lb4yko.R.inc(5337);dvalues[j] = readDouble(stream);</span>
                }
<span class="nc" id="L347">                }__CLR4_5_23zg3zgm6lb4yko.R.inc(5338);obj = dvalues;</span>
<span class="nc" id="L348">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5339);break;</span>

<span class="nc bnc" id="L350" title="All 2 branches missed.">            default:if (!__CLB4_5_2_bool0) {__CLR4_5_23zg3zgm6lb4yko.R.inc(5340);__CLB4_5_2_bool0=true;}</span>
<span class="nc" id="L351">                __CLR4_5_23zg3zgm6lb4yko.R.inc(5341);throw new RuntimeException(PropertyUtil.getString(&quot;TIFFDirectory0&quot;));</span>
            }

<span class="fc" id="L354">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5342);fields[i] = new TIFFField(tag, type, count, obj);</span>
<span class="fc" id="L355">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5343);stream.seek(nextTagOffset);</span>
        }

        // Read the offset of the next IFD.
<span class="fc" id="L359">        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5344);nextIFDOffset = readUnsignedInt(stream);</span>
<span class="fc" id="L360">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /** Returns the number of directory entries. */
<span class="nc" id="L363">    public int getNumEntries() {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5345);</span>
<span class="nc" id="L364">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5346);return numEntries;</span>
<span class="nc" id="L365">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns the value of a given tag as a TIFFField,
     * or null if the tag is not present.
     */
<span class="fc" id="L371">    public TIFFField getField(int tag) {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5347);</span>
<span class="fc" id="L372">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5348);Integer i = (Integer)fieldIndex.get(tag);</span>
<span class="pc bpc" id="L373" title="4 of 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5349);if ((((i == null)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5350)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5351)==0&amp;false))) {{</span>
<span class="fc" id="L374">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5352);return null;</span>
        } }else {{
<span class="fc" id="L376">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5353);return fields[i];</span>
        }
<span class="fc" id="L378">    }}finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns true if a tag appears in the directory.
     */
<span class="fc" id="L383">    public boolean isTagPresent(int tag) {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5354);</span>
<span class="fc" id="L384">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5355);return fieldIndex.containsKey(tag);</span>
<span class="fc" id="L385">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns an ordered array of ints indicating the tag
     * values.
     */
<span class="nc" id="L391">    public int[] getTags() {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5356);</span>
<span class="nc" id="L392">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5357);int[] tags = new int[fieldIndex.size()];</span>
<span class="nc" id="L393">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5358);Iterator iter = fieldIndex.keySet().iterator();</span>
<span class="nc" id="L394">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5359);int i = 0;</span>

<span class="nc bnc" id="L396" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5360);while ((((iter.hasNext())&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5361)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5362)==0&amp;false))) {{</span>
<span class="nc" id="L397">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5363);tags[i++] = (Integer) iter.next();</span>
        }

<span class="nc" id="L400">        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5364);return tags;</span>
<span class="nc" id="L401">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns an array of TIFFFields containing all the fields
     * in this directory.
     */
<span class="nc" id="L407">    public TIFFField[] getFields() {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5365);</span>
<span class="nc" id="L408">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5366);return fields;</span>
<span class="nc" id="L409">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns the value of a particular index of a given tag as a
     * byte.  The caller is responsible for ensuring that the tag is
     * present and has type TIFFField.TIFF_SBYTE, TIFF_BYTE, or
     * TIFF_UNDEFINED.
     */
<span class="nc" id="L417">    public byte getFieldAsByte(int tag, int index) {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5367);</span>
<span class="nc" id="L418">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5368);Integer i = (Integer)fieldIndex.get(tag);</span>
<span class="nc" id="L419">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5369);byte [] b = (fields[i]).getAsBytes();</span>
<span class="nc" id="L420">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5370);return b[index];</span>
<span class="nc" id="L421">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns the value of index 0 of a given tag as a
     * byte.  The caller is responsible for ensuring that the tag is
     * present and has  type TIFFField.TIFF_SBYTE, TIFF_BYTE, or
     * TIFF_UNDEFINED.
     */
<span class="nc" id="L429">    public byte getFieldAsByte(int tag) {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5371);</span>
<span class="nc" id="L430">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5372);return getFieldAsByte(tag, 0);</span>
<span class="nc" id="L431">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns the value of a particular index of a given tag as a
     * long.  The caller is responsible for ensuring that the tag is
     * present and has type TIFF_BYTE, TIFF_SBYTE, TIFF_UNDEFINED,
     * TIFF_SHORT, TIFF_SSHORT, TIFF_SLONG or TIFF_LONG.
     */
<span class="fc" id="L439">    public long getFieldAsLong(int tag, int index) {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5373);</span>
<span class="fc" id="L440">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5374);Integer i = (Integer)fieldIndex.get(tag);</span>
<span class="fc" id="L441">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5375);return (fields[i]).getAsLong(index);</span>
<span class="fc" id="L442">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns the value of index 0 of a given tag as a
     * long.  The caller is responsible for ensuring that the tag is
     * present and has type TIFF_BYTE, TIFF_SBYTE, TIFF_UNDEFINED,
     * TIFF_SHORT, TIFF_SSHORT, TIFF_SLONG or TIFF_LONG.
     */
<span class="fc" id="L450">    public long getFieldAsLong(int tag) {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5376);</span>
<span class="fc" id="L451">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5377);return getFieldAsLong(tag, 0);</span>
<span class="fc" id="L452">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns the value of a particular index of a given tag as a
     * float.  The caller is responsible for ensuring that the tag is
     * present and has numeric type (all but TIFF_UNDEFINED and
     * TIFF_ASCII).
     */
<span class="nc" id="L460">    public float getFieldAsFloat(int tag, int index) {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5378);</span>
<span class="nc" id="L461">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5379);Integer i = (Integer)fieldIndex.get(tag);</span>
<span class="nc" id="L462">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5380);return fields[i].getAsFloat(index);</span>
<span class="nc" id="L463">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns the value of index 0 of a given tag as a float.  The
     * caller is responsible for ensuring that the tag is present and
     * has numeric type (all but TIFF_UNDEFINED and TIFF_ASCII).
     */
<span class="nc" id="L470">    public float getFieldAsFloat(int tag) {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5381);</span>
<span class="nc" id="L471">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5382);return getFieldAsFloat(tag, 0);</span>
<span class="nc" id="L472">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns the value of a particular index of a given tag as a
     * double.  The caller is responsible for ensuring that the tag is
     * present and has numeric type (all but TIFF_UNDEFINED and
     * TIFF_ASCII).
     */
<span class="nc" id="L480">    public double getFieldAsDouble(int tag, int index) {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5383);</span>
<span class="nc" id="L481">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5384);Integer i = (Integer)fieldIndex.get(tag);</span>
<span class="nc" id="L482">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5385);return fields[i].getAsDouble(index);</span>
<span class="nc" id="L483">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns the value of index 0 of a given tag as a double.  The
     * caller is responsible for ensuring that the tag is present and
     * has numeric type (all but TIFF_UNDEFINED and TIFF_ASCII).
     */
<span class="nc" id="L490">    public double getFieldAsDouble(int tag) {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5386);</span>
<span class="nc" id="L491">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5387);return getFieldAsDouble(tag, 0);</span>
<span class="nc" id="L492">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    // Methods to read primitive data types from the stream

    private short readShort(SeekableStream stream)
<span class="nc" id="L497">        throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5388);</span>
<span class="nc bnc" id="L498" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5389);if ((((isBigEndian)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5390)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5391)==0&amp;false))) {{</span>
<span class="nc" id="L499">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5392);return stream.readShort();</span>
        } }else {{
<span class="nc" id="L501">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5393);return stream.readShortLE();</span>
        }
<span class="nc" id="L503">    }}finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    private int readUnsignedShort(SeekableStream stream)
<span class="fc" id="L506">        throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5394);</span>
<span class="pc bpc" id="L507" title="4 of 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5395);if ((((isBigEndian)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5396)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5397)==0&amp;false))) {{</span>
<span class="fc" id="L508">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5398);return stream.readUnsignedShort();</span>
        } }else {{
<span class="fc" id="L510">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5399);return stream.readUnsignedShortLE();</span>
        }
<span class="fc" id="L512">    }}finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    private int readInt(SeekableStream stream)
<span class="nc" id="L515">        throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5400);</span>
<span class="nc bnc" id="L516" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5401);if ((((isBigEndian)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5402)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5403)==0&amp;false))) {{</span>
<span class="nc" id="L517">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5404);return stream.readInt();</span>
        } }else {{
<span class="nc" id="L519">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5405);return stream.readIntLE();</span>
        }
<span class="nc" id="L521">    }}finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    private long readUnsignedInt(SeekableStream stream)
<span class="fc" id="L524">        throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5406);</span>
<span class="pc bpc" id="L525" title="4 of 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5407);if ((((isBigEndian)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5408)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5409)==0&amp;false))) {{</span>
<span class="fc" id="L526">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5410);return stream.readUnsignedInt();</span>
        } }else {{
<span class="fc" id="L528">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5411);return stream.readUnsignedIntLE();</span>
        }
<span class="fc" id="L530">    }}finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

//    private long readLong(SeekableStream stream)
//        throws IOException {
//        if (isBigEndian) {
//            return stream.readLong();
//        } else {
//            return stream.readLongLE();
//        }
//    }

    private float readFloat(SeekableStream stream)
<span class="nc" id="L542">        throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5412);</span>
<span class="nc bnc" id="L543" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5413);if ((((isBigEndian)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5414)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5415)==0&amp;false))) {{</span>
<span class="nc" id="L544">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5416);return stream.readFloat();</span>
        } }else {{
<span class="nc" id="L546">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5417);return stream.readFloatLE();</span>
        }
<span class="nc" id="L548">    }}finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    private double readDouble(SeekableStream stream)
<span class="nc" id="L551">        throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5418);</span>
<span class="nc bnc" id="L552" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5419);if ((((isBigEndian)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5420)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5421)==0&amp;false))) {{</span>
<span class="nc" id="L553">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5422);return stream.readDouble();</span>
        } }else {{
<span class="nc" id="L555">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5423);return stream.readDoubleLE();</span>
        }
<span class="nc" id="L557">    }}finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    private static int readUnsignedShort(SeekableStream stream,
                                         boolean isBigEndian)
<span class="nc" id="L561">        throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5424);</span>
<span class="nc bnc" id="L562" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5425);if ((((isBigEndian)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5426)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5427)==0&amp;false))) {{</span>
<span class="nc" id="L563">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5428);return stream.readUnsignedShort();</span>
        } }else {{
<span class="nc" id="L565">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5429);return stream.readUnsignedShortLE();</span>
        }
<span class="nc" id="L567">    }}finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    private static long readUnsignedInt(SeekableStream stream,
                                        boolean isBigEndian)
<span class="nc" id="L571">        throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5430);</span>
<span class="nc bnc" id="L572" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5431);if ((((isBigEndian)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5432)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5433)==0&amp;false))) {{</span>
<span class="nc" id="L573">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5434);return stream.readUnsignedInt();</span>
        } }else {{
<span class="nc" id="L575">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5435);return stream.readUnsignedIntLE();</span>
        }
<span class="nc" id="L577">    }}finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    // Utilities

    /**
     * Returns the number of image directories (subimages) stored in a
     * given TIFF file, represented by a &lt;code&gt;SeekableStream&lt;/code&gt;.
     */
    public static int getNumDirectories(SeekableStream stream)
<span class="nc" id="L586">        throws IOException {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5436);</span>
<span class="nc" id="L587">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5437);long pointer = stream.getFilePointer(); // Save stream pointer</span>

<span class="nc" id="L589">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5438);stream.seek(0L);</span>
<span class="nc" id="L590">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5439);int endian = stream.readUnsignedShort();</span>
<span class="nc bnc" id="L591" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5440);if ((((!isValidEndianTag(endian))&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5441)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5442)==0&amp;false))) {{</span>
<span class="nc" id="L592">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5443);throw new IllegalArgumentException(PropertyUtil.getString(&quot;TIFFDirectory1&quot;));</span>
        }
<span class="nc bnc" id="L594" title="All 2 branches missed.">        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5444);boolean isBigEndian = (endian == 0x4d4d);</span>
<span class="nc" id="L595">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5445);int magic = readUnsignedShort(stream, isBigEndian);</span>
<span class="nc bnc" id="L596" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5446);if ((((magic != 42)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5447)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5448)==0&amp;false))) {{</span>
<span class="nc" id="L597">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5449);throw new IllegalArgumentException(PropertyUtil.getString(&quot;TIFFDirectory2&quot;));</span>
        }

<span class="nc" id="L600">        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5450);stream.seek(4L);</span>
<span class="nc" id="L601">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5451);long offset = readUnsignedInt(stream, isBigEndian);</span>

<span class="nc" id="L603">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5452);int numDirectories = 0;</span>
<span class="nc bnc" id="L604" title="All 10 branches missed.">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5453);while ((((offset != 0L)&amp;&amp;(__CLR4_5_23zg3zgm6lb4yko.R.iget(5454)!=0|true))||(__CLR4_5_23zg3zgm6lb4yko.R.iget(5455)==0&amp;false))) {{</span>
<span class="nc" id="L605">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5456);++numDirectories;</span>

<span class="nc" id="L607">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5457);stream.seek(offset);</span>
<span class="nc" id="L608">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5458);long entries = readUnsignedShort(stream, isBigEndian);</span>
<span class="nc" id="L609">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5459);stream.skip(12 * entries);</span>
<span class="nc" id="L610">            __CLR4_5_23zg3zgm6lb4yko.R.inc(5460);offset = readUnsignedInt(stream, isBigEndian);</span>
<span class="nc" id="L611">        }</span>

<span class="nc" id="L613">        }__CLR4_5_23zg3zgm6lb4yko.R.inc(5461);stream.seek(pointer); // Reset stream pointer</span>
<span class="nc" id="L614">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5462);return numDirectories;</span>
<span class="nc" id="L615">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns a boolean indicating whether the byte order used in the
     * the TIFF file is big-endian.  That is, whether the byte order is from
     * the most significant to the least significant.
     */
<span class="nc" id="L622">    public boolean isBigEndian() {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5463);</span>
<span class="nc" id="L623">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5464);return isBigEndian;</span>
<span class="nc" id="L624">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns the offset of the IFD corresponding to this
     * &lt;code&gt;TIFFDirectory&lt;/code&gt;.
     */
<span class="nc" id="L630">    public long getIFDOffset() {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5465);</span>
<span class="nc" id="L631">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5466);return ifdOffset;</span>
<span class="nc" id="L632">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>

    /**
     * Returns the offset of the next IFD after the IFD corresponding to this
     * &lt;code&gt;TIFFDirectory&lt;/code&gt;.
     */
<span class="nc" id="L638">    public long getNextIFDOffset() {try{__CLR4_5_23zg3zgm6lb4yko.R.inc(5467);</span>
<span class="nc" id="L639">        __CLR4_5_23zg3zgm6lb4yko.R.inc(5468);return nextIFDOffset;</span>
<span class="nc" id="L640">    }finally{__CLR4_5_23zg3zgm6lb4yko.R.flushNeeded();}}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>